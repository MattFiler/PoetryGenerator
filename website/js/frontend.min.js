function init(){$(".lds-dual-ring").hide(),checkForRecall()}function sendImg(){0!=document.getElementById("uploadFile").files.length&&($(".image_upload").prop("disabled",!0),$(".submit_btn").prop("disabled",!0),$(".error_text").text(""),$(".lds-dual-ring").show(),EXIF.getData($(".image_upload").get(0).files[0],function(){myData=this;var t=[null,null];myData.exifdata.GPSLatitude&&(t=[convertDMSToDD(myData.exifdata.GPSLatitude,myData.exifdata.GPSLatitudeRef),convertDMSToDD(myData.exifdata.GPSLongitude,myData.exifdata.GPSLongitudeRef)]);createPostcard(t)}))}var newPostcardID=-1;function createPostcard(t){$(".step_1").fadeOut(500,function(){$(".step_2").fadeIn()});var e=new FormData;e.append("img",$(".image_upload").get(0).files[0]),e.append("gps_lat",t[0]),e.append("gps_lon",t[1]),$.ajax({url:"php/postcard_generator.php",data:e,type:"POST",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(t){if("N/A"==t.error){for(var e="",a=0;a<t.autogen_labels.length;a++){e+="<p><button class='btn btn-primary word_button' onClick='pickWord(\""+t.autogen_labels[a].word+"\", this, null);'>"+t.autogen_labels[a].word+"</button>";for(var o=0;o<t.autogen_labels[a].synonyms.length;o++)e+="&nbsp;<button class='btn btn-secondary word_button' onClick='pickWord(\""+t.autogen_labels[a].synonyms[o]+"\", this, null);'>"+t.autogen_labels[a].synonyms[o]+"</button>";e+="</p>"}var r=1;t.autogen_labels.length<3&&(r+=3-t.autogen_labels.length);for(a=0;a<r;a++)e+='<div class="input-group mb-3"><input type="text" class="form-control custom_word_entry custom_word_entry_'+a+'" placeholder="Custom word..." maxlength="15"><div class="input-group-append"><button class="btn btn-primary custom_word_btn" onClick=\'pickWord($(".custom_word_entry_'+a+'").val(), this, $(".custom_word_entry_'+a+"\"));'>Select</button></div></div>";$(".words_list").html(e),newPostcardID=t.postcard_id,$(".step_2").fadeOut(500,function(){$(".step_3").fadeIn()}),$(".character_profilepic").attr("src",t.character.img_url),$(".custom_character_name").html(t.character.name),submitCustomWords(".step_3")}else postcardCreationFailed(t.error)},error:function(t,e,a){postcardCreationFailed(a)}})}function postcardCreationFailed(t){$(".step_2").fadeOut(500,function(){$(".step_1").fadeIn(500,function(){$(".step_2").hide()})}),$(".error_text").text(t),$(".image_upload").prop("disabled",!1),$(".submit_btn").prop("disabled",!1),$(".lds-dual-ring").hide()}function showWordList(){$(".step_2").fadeOut(500,function(){$(".step_3").fadeIn()})}var pickedWordList=[null,null,null];function pickWord(t,e,a){""!=t&&($(e).prop("disabled",!0),null!=a&&$(a).prop("disabled",!0),null==pickedWordList[0]?pickedWordList[0]=t:null==pickedWordList[1]?pickedWordList[1]=t:null==pickedWordList[2]&&(pickedWordList[2]=t,$(".word_button").prop("disabled",!0),$(".custom_word_entry").prop("disabled",!0),$(".custom_word_btn").prop("disabled",!0),$(".error_text_words").text(""),$(".lds-dual-ring").show(),submitCustomWords(".step_3")))}function submitCustomWords(t){var e=new FormData;e.append("id",newPostcardID),e.append("word_1",pickedWordList[0]),e.append("word_2",pickedWordList[1]),e.append("word_3",pickedWordList[2]),$.ajax({url:"php/postcard_updatewords.php",data:e,type:"POST",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(e){$(".fa-pause").show(),$(".fa-play").hide(),showPostcard(e,t)},error:function(t,e,a){$(".error_text_words").text(a)}})}function rerollPostcard(){-1!=newPostcardID&&($(".lds-dual-ring").show(),$(".step_4").fadeOut(500,function(){$(".step_3").fadeIn()}),submitCustomWords(".step_3"),$(".thinking_text_override").html("Rethinking..."))}function checkForRecall(){let t=new URLSearchParams(window.location.search);if(!t.has("id"))return;$(".image_upload").prop("disabled",!0),$(".submit_btn").prop("disabled",!0),$(".error_text").text(""),$(".lds-dual-ring").show();let e=t.get("id");$.ajax({url:"php/get_postcard.php?id="+e,dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(t){$(".fa-pause").hide(),$(".fa-play").show(),showPostcard(t,".step_1",0)},error:function(t,e,a){$(".error_text").text(a),$(".image_upload").prop("disabled",!1),$(".submit_btn").prop("disabled",!1)}})}var thisPostcardID="";function showPostcard(t,e,a=500){if("N/A"==t.error){if(void 0!==history.pushState){var o={Title:"similie",Url:"?id="+t.image_id};history.pushState(o,o.Title,o.Url)}if($(".error_text").text(""),$(".error_text_words").text(""),$(".lds-dual-ring").hide(),thisPostcardID=t.image_id,null!=t.poem&&""!=t.poem){for(var r="",d=0;d<t.poem.length;d++)r+="<p>"+t.poem[d].replace("???","&apos;").replace("??","&apos;")+"</p>";$(".output_poem").html(r),$(".output_author").text(t.poem_author)}$(".output_image").attr("src",t.image_url),$(".output_sound").attr("src",t.soundscape_url),$(".output_url").val("https://"+$(location).attr("hostname")+"?id="+thisPostcardID),$(".email_share_btn").attr("href","mailto:?subject=Postcard&body=Check%20out%20my%20postcard!%0D"+$(".output_url").val()),$(".twitter_share_btn").attr("href","https://twitter.com/intent/tweet?text=Check%20out%20my%20postcard!%0D"+$(".output_url").val()),document.querySelector(".output_sound").play(),updatePlayPauseUI(),-1!=newPostcardID?$(".postcard_reroll").show():$(".postcard_reroll").hide(),$(e).fadeOut(a,function(){$(".step_4").fadeIn(a,function(){updatePlayPauseUI()})})}else $(".lds-dual-ring").hide(),$(".error_text").text(t.error),$(".image_upload").prop("disabled",!1),$(".submit_btn").prop("disabled",!1)}function copyShareURL(){$(".output_url").select(),document.execCommand("copy")}function convertDMSToDD(t,e){var a=t[0]+t[1]/60+t[2]/3600;return"S"!=e&&"W"!=e||(a*=-1),a}function toggleSoundscape(){var t=document.querySelector(".output_sound");t.paused?t.play():(t.pause(),t.currentTime=0),updatePlayPauseUI()}function updatePlayPauseUI(){document.querySelector(".output_sound").paused?($(".fa-pause").hide(),$(".fa-play").show()):($(".fa-pause").show(),$(".fa-play").hide())}
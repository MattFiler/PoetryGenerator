var characterData,authorData,characterSelectedIndex=0;function init(){refreshAllCharacters()}function refreshAllCharacters(){$(".error_text").hide(),$(".lds-dual-ring").show(),$.ajax({url:"../php/get_characters.php",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(a){characterData=a;for(var e="",r=0;r<a.length;r++)e+='<option value="'+a[r].name+'">'+a[r].name+"</option>";$(".character_list").html(e),$.ajax({url:"../php/get_authors.php",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(a){authorData=a,$(".character_list").prop("selectedIndex",characterSelectedIndex),loadCharacter()},error:function(a,e,r){$(".lds-dual-ring").hide(),$(".error_text").show(),$(".col-md-12").hide()}})},error:function(a,e,r){$(".lds-dual-ring").hide(),$(".error_text").show(),$(".col-md-12").hide()}})}function loadCharacter(){characterSelectedIndex=$(".character_list").prop("selectedIndex"),$(".lds-dual-ring").show(),$(".character_name").val(characterData[characterSelectedIndex].name),$(".character_era").val(characterData[characterSelectedIndex].era),$(".character_image").val(characterData[characterSelectedIndex].img_url),$(".character_location_lat").val(characterData[characterSelectedIndex].location.lat),$(".character_location_lon").val(characterData[characterSelectedIndex].location.lon);for(var a="",e=0;e<authorData.length;e++){a+='<input type="checkbox" id="'+authorData[e].name+'" class="char_author_'+e+'" value="'+authorData[e].name+'"';for(var r=0;r<characterData[characterSelectedIndex].authors.length;r++)if(characterData[characterSelectedIndex].authors[r]==authorData[e].name){a+=" checked";break}a+='><label for="'+authorData[e].name+'">&nbsp;&nbsp;'+authorData[e].name+' (<font color="',authorData[e].size<35e3&&(a+="red"),authorData[e].size<1e5?a+="orange":a+="green",a+='">'+authorData[e].size+" dataset</font>)</label><br>"}$(".author_list").html(a),$(".lds-dual-ring").hide()}function saveCharacter(){$(".lds-dual-ring").show();for(var a=[],e=0;e<authorData.length;e++)$(".char_author_"+e).prop("checked")&&a.push(authorData[e].name);var r=new FormData;r.append("index",characterSelectedIndex),r.append("era",$(".character_era").val()),r.append("name",$(".character_name").val()),r.append("authors",a),r.append("img_url",$(".character_image").val()),r.append("lat",$(".character_location_lat").val()),r.append("lon",$(".character_location_lon").val()),$.ajax({url:"../php/save_character.php",data:r,type:"POST",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(a){$(".lds-dual-ring").hide(),document.body.scrollTop=0,document.documentElement.scrollTop=0,refreshAllCharacters()},error:function(a,e,r){$(".lds-dual-ring").hide(),$(".error_text").show(),$(".col-md-12").hide()}})}function refreshAllSoundscapes(){$(".lds-dual-ring").show(),$(".error_text").hide(),$.ajax({url:"../php/get_soundscapes.php",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(a){for(var e="",r=0;r<a.length;r++){e+="<tr class='soundscape_display_"+a[r].id+"'><td><ul>";for(var t=0;t<a[r].data.matching_words.length;t++)e+="<li>"+a[r].data.matching_words[t]+"</li>";e+="</ul></td><td>"+a[r].data.sound_url+"</td><td>",e+="<button class='btn btn-danger' onClick='deleteSoundscape("+a[r].id+");'>Delete</button></tr>"}$(".soundscape_table").html(e),$(".lds-dual-ring").hide()},error:function(a,e,r){$(".lds-dual-ring").hide(),$(".error_text").show(),$(".col-md-12").hide()}})}function deleteSoundscape(a){$(".lds-dual-ring").show(),$.ajax({url:"../php/delete_soundscape.php?id="+a,dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(e){$(".soundscape_display_"+a).hide(),$(".lds-dual-ring").hide()},error:function(a,e,r){$(".lds-dual-ring").hide(),$(".error_text").show(),$(".col-md-12").hide()}})}function saveSoundscape(){$(".lds-dual-ring").show();var a=new FormData;a.append("keywords",$(".soundscape_keywords").val()),a.append("url",$(".soundscape_url").val()),$.ajax({url:"../php/save_soundscape.php",data:a,type:"POST",dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(a){$(".lds-dual-ring").hide(),$(".soundscape_keywords").val(""),$(".soundscape_url").val(""),refreshAllSoundscapes()},error:function(a,e,r){$(".lds-dual-ring").hide(),$(".error_text").show(),$(".col-md-12").hide()}})}